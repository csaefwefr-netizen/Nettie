<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸­æ–‡ç»ƒä¹ å¤§æŒ‘æˆ˜ - æ–°æœ‹å‹2</title>
    <style>
        :root {
            --primary: #FF9A9E; 
            --secondary: #FECFEF;
            --accent: #A18CD1;
            --bg: #F0F4F8;
            --text: #333333;
            --white: #FFFFFF;
        }

        body {
            font-family: "Microsoft YaHei", "Heiti SC", sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            font-size: 20px;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; 
        }

        .container {
            width: 100%;
            max-width: 850px;
            background: var(--white);
            border-radius: 20px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            padding: 30px;
            margin-top: 20px;
            position: relative;
        }

        .top-bar {
            display: flex;
            justify-content: flex-end;
            gap: 10px; 
            margin-bottom: 10px;
        }
        
        .tool-btn {
            background: var(--secondary);
            color: var(--accent);
            border: 2px solid var(--accent);
            padding: 8px 15px;
            border-radius: 15px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9em;
            transition: 0.3s;
            min-width: 100px;
        }
        .tool-btn:hover {
            background: var(--accent);
            color: white;
        }

        h1 { font-size: 2.2em; text-align: center; color: var(--accent); margin-bottom: 0.5em; }
        h2 { font-size: 1.8em; color: var(--primary); margin-bottom: 0.8em; text-align: center; }
        
        .btn {
            background: linear-gradient(to right, var(--primary), var(--accent));
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 1.2em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            margin: 15px 5px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn:disabled { background: #ccc; cursor: not-allowed; }

        input[type="text"] {
            padding: 15px;
            font-size: 1.5em;
            border-radius: 15px;
            border: 3px solid var(--secondary);
            width: 80%;
            max-width: 400px;
            text-align: center;
            display: block;
            margin: 20px auto;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px dashed var(--secondary);
            padding-bottom: 15px;
            margin-bottom: 20px;
            font-size: 1.2em;
            font-weight: bold;
        }

        .progress-container {
            height: 15px;
            background-color: #eee;
            border-radius: 10px;
            margin-bottom: 30px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.5s ease;
        }

        .match-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .match-card {
            background: var(--white);
            border: 2px solid var(--secondary);
            padding: 10px;
            text-align: center;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            min-height: 55px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: 0.2s;
            line-height: 1.2;
        }
        .match-card.selected { background: var(--accent); color: white; border-color: var(--accent); }
        /* é€‰ä¸­æ—¶å¼ºåˆ¶è®©é‡Œé¢çš„æ‹¼éŸ³ä¹Ÿå˜ç™½ï¼Œä¿æŒå¯¹æ¯”åº¦ */
        .match-card.selected span { color: white !important; }
        .match-card.matched { visibility: hidden; opacity: 0; }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .option-btn {
            background: white;
            border: 3px solid var(--primary);
            color: var(--text);
            padding: 15px;
            border-radius: 15px;
            font-size: 1.2em;
            cursor: pointer;
            white-space: normal;
        }
        .option-btn:hover { background: var(--secondary); }

        .hint-text { font-size: 1.8em; font-weight: bold; color: var(--accent); text-align: center; margin: 10px 0; }
        .pinyin-hint { font-size: 1.4em; color: var(--primary); margin-top: 15px; text-align: center; }
        
        @media (max-width: 600px) {
            .options-grid { grid-template-columns: 1fr; }
            h1 { font-size: 1.6em; }
            .match-grid { gap: 8px; }
            .match-card { font-size: 0.85em; padding: 6px; min-height: 45px; }
        }

        .hidden { display: none; }
        .fade-in { animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

<div class="container">
    <div class="top-bar">
        <button class="tool-btn" onclick="toggleLang()" id="global-lang-btn">è½¬ç¹ä½“</button>
    </div>

    <!-- ç™»å½•ç•Œé¢ -->
    <div id="login-screen" class="fade-in" style="text-align: center; padding: 40px 0;">
        <h1 id="ui-welcome-title">ä¸­æ–‡ç»ƒä¹ å¤§æŒ‘æˆ˜ - æ–°æœ‹å‹2</h1>
        <p id="ui-enter-name-desc">è¯·è¾“å…¥ä½ çš„åå­—å¼€å§‹æ¸¸æˆ</p>
        <input type="text" id="nickname" placeholder="è¾“å…¥åå­—">
        <button class="btn" onclick="startGame()" id="ui-start-btn">å¼€å§‹æŒ‘æˆ˜</button>
    </div>

    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-interface" class="hidden">
        <div class="game-header">
            <div>ğŸ‘¤ <span id="display-name">Player</span></div>
            <div>â­ <span id="score" style="color:var(--primary); font-size:1.4em;">0</span> <span id="ui-score-unit">åˆ†</span></div>
        </div>
        <div class="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>
        <div id="game-stage"></div>
    </div>
</div>

<script>
    // --- 1. æ•°æ®å‡†å¤‡ ---
    const vocabData = [
        { id: 1, zh: "æ˜¥èŠ‚", en: "spring festival", pinyin: "chÅ«n jiÃ©" },
        { id: 2, zh: "å¿«åˆ°äº†", en: "arriving soon", pinyin: "kuÃ i dÃ o le" },
        { id: 3, zh: "è¿‡å¹´", en: "celebrate Chinese New Year", pinyin: "guÃ² niÃ¡n" },
        { id: 4, zh: "å›¢åœ†", en: "reunion", pinyin: "tuÃ¡n yuÃ¡n" },
        { id: 5, zh: "å±é¾™", en: "Zodiac year of birth is dragon", pinyin: "shÇ” lÃ³ng" },
        { id: 6, zh: "æœ¬å‘½å¹´", en: "Zodiac year of birth", pinyin: "bÄ›n mÃ¬ng niÃ¡n" },
        { id: 7, zh: "å‘Šè¯‰", en: "tell", pinyin: "gÃ o sÃ¹" },
        { id: 8, zh: "å¥½è¿æ°”", en: "Good luck", pinyin: "hÇo yÃ¹n qÃ¬" },
        { id: 9, zh: "å†™ä¿¡", en: "write a letter", pinyin: "xiÄ› xÃ¬n" },
        { id: 10, zh: "ç¥", en: "to wish", pinyin: "zhÃ¹" }
    ];

    const quizData = [
        { q: "ä»€ä¹ˆèŠ‚æ—¥å¿«åˆ°äº†ï¼Ÿ", a: "ä¸­å›½æ˜¥èŠ‚" },
        { q: "è¿‡å¹´çš„æ—¶å€™ï¼Œä¸­å›½äººä¼šå’Œå®¶äººåšä»€ä¹ˆï¼Ÿ", a: "å›¢åœ†" },
        { q: "Lisaæ˜¯å‡ å¹´å‡ºç”Ÿçš„ï¼Ÿ", a: "äºŒé›¶ä¸€äºŒå¹´" },
        { q: "Lisaçš„ç”Ÿè‚–æ˜¯ä»€ä¹ˆï¼Ÿ", a: "Lisaå±é¾™" },
        { q: "Lisaå±é¾™ï¼Œä»Šå¹´åˆæ˜¯é¾™å¹´ï¼Œæ‰€ä»¥ä»Šå¹´æ˜¯Lisaçš„ä»€ä¹ˆå¹´ï¼Ÿ", a: "æœ¬å‘½å¹´" },
        { q: "æœ‹å‹ä»¬ç»™äº†Lisaä»€ä¹ˆï¼Ÿ", a: "çº¢è‰²çš„è¡£æœ" },
        { q: "æœ‹å‹ä»¬ä¸ºä»€ä¹ˆç»™Lisaçº¢è‰²çš„è¡£æœï¼Ÿ", a: "å› ä¸ºä¼šæœ‰å¥½è¿æ°”" },
        { q: "Lisaåœ¨ç»™ç¬‘ç¬‘å†™ä»€ä¹ˆå‘¢ï¼Ÿ", a: "å†™ä¿¡" }
    ];

    const allAnswers = quizData.map(item => item.a);

    // --- 2. ç¹ç®€ä½“å…¨é‡å­—å…¸ ---
    const fullTradMap = {
        "è½¬ç¹ä½“": "è½‰ç¹é«”", "è½¬ç®€ä½“": "è½‰ç°¡é«”", "ä¸­æ–‡ç»ƒä¹ å¤§æŒ‘æˆ˜ - æ–°æœ‹å‹2": "ä¸­æ–‡ç·´ç¿’å¤§æŒ‘æˆ° - æ–°æœ‹å‹2",
        "è¯·è¾“å…¥ä½ çš„åå­—å¼€å§‹æ¸¸æˆ": "è«‹è¼¸å…¥ä½ çš„åå­—é–‹å§‹éŠæˆ²", "è¾“å…¥åå­—": "è¼¸å…¥åå­—", "å¼€å§‹æŒ‘æˆ˜": "é–‹å§‹æŒ‘æˆ°", "åˆ†": "åˆ†",
        "è¿è¿çœ‹": "é€£é€£çœ‹", "å¤ªæ£’äº†": "å¤ªæ£’äº†", "ä¸‹ä¸€å…³": "ä¸‹ä¸€é—œ", "å¡«ç©ºé¢˜": "å¡«ç©ºé¡Œ", "è¯·è¾“å…¥ä¸­æ–‡": "è«‹è¼¸å…¥ä¸­æ–‡",
        "è¾“å…¥ç­”æ¡ˆ": "è¼¸å…¥ç­”æ¡ˆ", "æäº¤": "æäº¤", "æç¤º": "æç¤º", "æ‹¼éŸ³æç¤º": "æ‹¼éŸ³æç¤º", "æ­£ç¡®": "æ­£ç¢º", "é”™è¯¯": "éŒ¯èª¤", "ä¸å¯¹å“¦": "ä¸å°å“¦",
        "è¯·ä½¿ç”¨ç®€ä½“è¾“å…¥": "è«‹ä½¿ç”¨ç°¡é«”è¼¸å…¥", "è¯·ä½¿ç”¨ç¹ä½“è¾“å…¥": "è«‹ä½¿ç”¨ç¹é«”è¼¸å…¥", "é˜…è¯»é€‰æ‹©": "é–±è®€é¸æ“‡", "æŒ‘æˆ˜æˆåŠŸ": "æŒ‘æˆ°æˆåŠŸ",
        "ä½ çš„æœ€ç»ˆå¾—åˆ†": "ä½ çš„æœ€çµ‚å¾—åˆ†", "å†ç©ä¸€æ¬¡": "å†ç©ä¸€æ¬¡",
        "æ˜¥èŠ‚": "æ˜¥ç¯€", "è¿‡å¹´": "éå¹´", "å›¢åœ†": "åœ˜åœ“", "å±é¾™": "å±¬é¾", "å‘Šè¯‰": "å‘Šè¨´", "å¥½è¿æ°”": "å¥½é‹æ°£", "å†™ä¿¡": "å¯«ä¿¡",
        "ä¸­å›½æ˜¥èŠ‚": "ä¸­åœ‹æ˜¥ç¯€", "äºŒé›¶ä¸€äºŒå¹´": "äºŒé›¶ä¸€äºŒå¹´", "çº¢è‰²çš„è¡£æœ": "ç´…è‰²çš„è¡£æœ", "å› ä¸ºä¼šæœ‰å¥½è¿æ°”": "å› ç‚ºæœƒæœ‰å¥½é‹æ°£",
        "ä»€ä¹ˆæ—¶å€™": "ä»€éº¼æ™‚å€™", "ä»€ä¹ˆ": "ä»€éº¼", "ä¸ºä»€ä¹ˆ": "ç‚ºä»€éº¼", "å‡ å¹´": "å¹¾å¹´"
    };

    // --- 3. çŠ¶æ€ç®¡ç† ---
    let state = {
        nickname: "",
        score: 0,
        isTraditional: false,
        gamePhase: 0, 
        currentLevelIndex: 0,
        matchSelected: null
    };

    // --- 4. å·¥å…·å‡½æ•° ---
    function t(text) {
        if (!state.isTraditional) return text;
        if (fullTradMap[text]) return fullTradMap[text];
        let res = text;
        for (let key in fullTradMap) {
            res = res.replace(new RegExp(key, 'g'), fullTradMap[key]);
        }
        return res;
    }

    function toTradForce(text) {
        let res = text;
        for (let key in fullTradMap) {
            res = res.replace(new RegExp(key, 'g'), fullTradMap[key]);
        }
        return res;
    }

    function toggleLang() {
        state.isTraditional = !state.isTraditional;
        document.getElementById('global-lang-btn').textContent = state.isTraditional ? "è½¬ç®€ä½“" : "è½¬ç¹ä½“";
        document.getElementById('ui-welcome-title').textContent = t("ä¸­æ–‡ç»ƒä¹ å¤§æŒ‘æˆ˜ - æ–°æœ‹å‹2");
        document.getElementById('ui-enter-name-desc').textContent = t("è¯·è¾“å…¥ä½ çš„åå­—å¼€å§‹æ¸¸æˆ");
        document.getElementById('nickname').placeholder = t("è¾“å…¥åå­—");
        document.getElementById('ui-start-btn').textContent = t("å¼€å§‹æŒ‘æˆ˜");
        document.getElementById('ui-score-unit').textContent = t("åˆ†");
        if (!document.getElementById('game-interface').classList.contains('hidden')) {
            loadPhase(state.gamePhase, false);
        }
    }

    function startGame() {
        const input = document.getElementById('nickname').value;
        if (!input) return alert(t("è¯·è¾“å…¥ä½ çš„åå­—å¼€å§‹æ¸¸æˆ"));
        state.nickname = input;
        document.getElementById('display-name').textContent = state.nickname;
        document.getElementById('login-screen').classList.add('hidden');
        document.getElementById('game-interface').classList.remove('hidden');
        loadPhase(0);
    }

    function updateScore(points) {
        state.score += points;
        document.getElementById('score').textContent = state.score;
    }

    function updateProgress(current, total, basePercentage) {
        const stageProgress = (current / total) * 33.3;
        document.getElementById('progress').style.width = (basePercentage + stageProgress) + "%";
    }

    // --- 5. æ¸¸æˆé€»è¾‘ ---
    function loadPhase(phase, resetIndex = true) {
        state.gamePhase = phase;
        if(resetIndex) state.currentLevelIndex = 0;
        const stage = document.getElementById('game-stage');
        stage.innerHTML = "";
        stage.className = "fade-in";

        if (phase === 0) startMatchingGame(stage);
        else if (phase === 1) startFillGame(stage);
        else if (phase === 2) startQuizGame(stage);
        else showEndScreen(stage);
    }

    // è¿è¿çœ‹
    function startMatchingGame(container) {
        container.innerHTML = `<h2>${t("è¿è¿çœ‹")}</h2><div class="match-grid" id="match-grid"></div>`;
        let cards = [];
        vocabData.forEach(item => {
            cards.push({ type: 'zh', text: item.zh, pinyin: item.pinyin, id: item.id });
            cards.push({ type: 'en', text: item.en, id: item.id });
        });
        cards.sort(() => Math.random() - 0.5);

        const grid = document.getElementById('match-grid');
        cards.forEach(card => {
            const div = document.createElement('div');
            div.className = 'match-card';
            if (card.type === 'zh') {
                // æ‹¼éŸ³é¢œè‰²æ”¹ä¸ºé»‘è‰² (color: black)
                div.innerHTML = `${t(card.text)}<br><span style="font-size:0.85em; color:black; font-weight:normal;">(${card.pinyin})</span>`;
            } else {
                div.textContent = card.text;
            }
            div.dataset.id = card.id;
            div.onclick = (e) => handleMatchClick(e.target);
            grid.appendChild(div);
        });
        updateProgress(0, vocabData.length, 0);
    }

    function handleMatchClick(el) {
        while (el && !el.classList.contains('match-card')) {
            el = el.parentElement;
        }
        if (!el || el.classList.contains('matched') || el.classList.contains('selected')) return;

        el.classList.add('selected');
        if (!state.matchSelected) {
            state.matchSelected = el;
        } else {
            const first = state.matchSelected;
            if (first.dataset.id === el.dataset.id) {
                setTimeout(() => {
                    first.classList.remove('selected'); el.classList.remove('selected');
                    first.classList.add('matched'); el.classList.add('matched');
                    updateScore(10);
                    checkMatchEnd();
                }, 300);
            } else {
                setTimeout(() => {
                    first.classList.remove('selected'); el.classList.remove('selected');
                }, 500);
            }
            state.matchSelected = null;
        }
    }

    function checkMatchEnd() {
        const remaining = document.querySelectorAll('.match-card:not(.matched)');
        if (remaining.length === 0) {
            setTimeout(() => { alert(t("å¤ªæ£’äº†") + "ï¼" + t("ä¸‹ä¸€å…³")); loadPhase(1); }, 500);
        }
    }

    // å¡«ç©ºé¢˜
    function startFillGame(container) {
        const item = vocabData[state.currentLevelIndex];
        updateProgress(state.currentLevelIndex, vocabData.length, 33);
        container.innerHTML = `
            <div style="text-align:center;">
                <h2>${t("å¡«ç©ºé¢˜")} (${state.currentLevelIndex + 1}/${vocabData.length})</h2>
                <p>${t("è¯·è¾“å…¥ä¸­æ–‡")}</p>
                <div class="hint-text">${item.en}</div>
                <input type="text" id="fill-input" placeholder="${t("è¾“å…¥ç­”æ¡ˆ")}">
                <button class="btn" onclick="checkFillAnswer()">${t("æäº¤")}</button>
                <div id="pinyin-hint" class="pinyin-hint" style="display:none">
                    ğŸ’¡ ${t("æ‹¼éŸ³æç¤º")}: ${item.pinyin}
                </div>
                <div id="feedback" style="font-size:1.5em; font-weight:bold; margin-top:20px;"></div>
            </div>
        `;
    }

    function checkFillAnswer() {
        const input = document.getElementById('fill-input').value.trim();
        const baseCorrect = vocabData[state.currentLevelIndex].zh;
        const tradCorrect = toTradForce(baseCorrect);
        const expectedAnswer = state.isTraditional ? tradCorrect : baseCorrect;
        const feedback = document.getElementById('feedback');

        if (input === expectedAnswer) {
            feedback.innerHTML = `<span style="color:#4CAF50">âœ… ${t("æ­£ç¡®")}ï¼</span>`;
            updateScore(10);
            setTimeout(() => {
                state.currentLevelIndex++;
                if (state.currentLevelIndex < vocabData.length) startFillGame(document.getElementById('game-stage'));
                else { alert(t("å¤ªæ£’äº†") + "ï¼" + t("ä¸‹ä¸€å…³")); loadPhase(2); }
            }, 1000);
        } else {
            let msg = t("ä¸å¯¹å“¦");
            if (state.isTraditional && input === baseCorrect && baseCorrect !== tradCorrect) msg = t("è¯·ä½¿ç”¨ç¹ä½“è¾“å…¥");
            else if (!state.isTraditional && input === tradCorrect && baseCorrect !== tradCorrect) msg = t("è¯·ä½¿ç”¨ç®€ä½“è¾“å…¥");
            feedback.innerHTML = `<span style="color:#F44336">âŒ ${msg}</span>`;
            document.getElementById('pinyin-hint').style.display = 'block';
        }
    }

    // é€‰æ‹©é¢˜
    function startQuizGame(container) {
        const q = quizData[state.currentLevelIndex];
        updateProgress(state.currentLevelIndex, quizData.length, 66);
        let options = [q.a];
        while (options.length < 4) {
            const randomAns = allAnswers[Math.floor(Math.random() * allAnswers.length)];
            if (!options.includes(randomAns)) options.push(randomAns);
        }
        options.sort(() => Math.random() - 0.5);
        container.innerHTML = `
            <div style="text-align:center;">
                <h2>${t("é˜…è¯»é€‰æ‹©")} (${state.currentLevelIndex + 1}/${quizData.length})</h2>
                <div style="font-size:1.4em; font-weight:bold; margin: 30px 0; text-align:left; background:#f9f9f9; padding:20px; border-radius:15px;">
                    ${t(q.q)}
                </div>
                <div class="options-grid">
                    ${options.map(opt => `<button class="option-btn" onclick="checkQuizAnswer('${opt}', '${q.a}', this)">${t(opt)}</button>`).join('')}
                </div>
            </div>
        `;
    }

    function checkQuizAnswer(selected, correct, btnElement) {
        if (selected === correct) {
            btnElement.style.background = "#d4edda";
            updateScore(10);
            setTimeout(() => {
                state.currentLevelIndex++;
                if (state.currentLevelIndex < quizData.length) startQuizGame(document.getElementById('game-stage'));
                else loadPhase(3);
            }, 500);
        } else {
            btnElement.style.background = "#f8d7da";
            btnElement.disabled = true;
        }
    }

    function showEndScreen(container) {
        updateProgress(1, 1, 100);
        container.innerHTML = `
            <div style="text-align:center; padding-top:50px;">
                <h1 style="font-size:3em;">ğŸ‰ ${t("æŒ‘æˆ˜æˆåŠŸ")}ï¼</h1>
                <p style="font-size:1.8em">${t("ä½ çš„æœ€ç»ˆå¾—åˆ†")}: <span style="color:var(--primary); font-weight:bold">${state.score}</span></p>
                <button class="btn" onclick="location.reload()">${t("å†ç©ä¸€æ¬¡")}</button>
            </div>
        `;
    }
</script>
</body>
</html>
